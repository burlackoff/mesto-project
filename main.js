(()=>{"use strict";var t="plus-cohort-12",e="ae6caf2d-a00b-4726-a9ec-c3ff5914df0b",n="94daa3f73b361f2df69c95ee";function o(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t))}var r=document.querySelector("#popup_info"),c=r.querySelector(".popup__input_info_name"),u=r.querySelector(".popup__input_info_profession"),a=r.querySelector(".popup__button"),i=r.querySelector(".popup__form"),s=document.querySelector(".profile__edit"),l=document.querySelector(".profile__name"),p=document.querySelector(".profile__profession"),d=document.querySelector("#popup_card"),_=document.querySelector(".profile__add"),f=d.querySelector(".popup__button"),v=d.querySelector(".popup__form"),m=d.querySelector(".popup__input_name_image"),h=d.querySelector(".popup__input_src_image"),y=document.querySelector("#popup_image"),S=y.querySelector(".popup__image"),q=y.querySelector(".popup__subtitle"),L=y.querySelector(".popup__button"),b=document.querySelector("#popup_avatar"),E=document.querySelector(".profile__avatar-edit"),k=b.querySelector(".popup__button"),C=b.querySelector(".popup__input_src_avatar"),g=b.querySelector(".popup__form"),x=document.querySelector(".profile__avatar"),w=document.querySelector("#popup_delete-card"),T=w.querySelector(".popup__button"),z=w.querySelector(".popup__form"),A=document.querySelector(".cards__list"),B=document.querySelector("#template_card").content,D={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_active"},P={name:"",link:"",likes:[],owner:{name:"",about:"",avatar:"",_id:"".concat(n)},_id:""};function j(t,e,n){var o=n.inactiveButtonClass;!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?e.classList.remove(o):e.classList.add(o)}function N(t,e){var n=e.formSelector,o=e.inputSelector,r=e.submitButtonSelector,c=e.errorClass,u=e.inputErrorClass,a=e.inactiveButtonClass,i=t.querySelector(n),s=i.querySelectorAll(o),l=i.querySelector(r);s.forEach((function(t){i.querySelector(".".concat(t.id,"-error")).classList.remove(c),t.classList.remove(u)})),l.classList.add(a)}function O(t){t.classList.add("popup_opened"),document.addEventListener("keydown",H),t.addEventListener("click",M)}function J(t){t.classList.remove("popup_opened"),document.removeEventListener("keydown",H),t.removeEventListener("click",M)}function H(t){"Escape"===t.key&&J(document.querySelector(".popup_opened"))}function M(t){var e=document.querySelector(".popup_opened");t.target===e&&J(e)}function U(r){var c=r.name,u=r.link,a=r.likes,i=r.owner,s=r._id,l=B.querySelector("li").cloneNode(!0),p=l.querySelector(".card__like-count"),d=l.querySelector(".card__like-button"),_=l.querySelector(".card__trash-button"),f=l.querySelector(".card__image");return l.querySelector(".card__title").textContent=c,f.src=u,f.alt=c,0!==a.length&&(p.textContent=a.length),i._id!==n&&_.remove(),a.find((function(t){return t._id===n}))&&d.classList.add("card__like-button_active"),function(n,r,c,u,a,i,s,l){n.addEventListener("click",(function(){var r;n.classList.contains("card__like-button_active")?((r=s,fetch("https://nomoreparties.co/v1/".concat(t,"/cards/likes/").concat(r),{method:"DELETE",headers:{authorization:"".concat(e)}}).then((function(t){return o(t)})).catch((function(t){return console.log(t)}))).then((function(t){return l.textContent=t.likes.length})),n.classList.remove("card__like-button_active")):n.classList.contains("card__like-button_active")||(function(n){return fetch("https://nomoreparties.co/v1/".concat(t,"/cards/likes/").concat(n),{method:"PUT",headers:{authorization:"".concat(e)}}).then((function(t){return o(t)})).catch((function(t){return console.log(t)}))}(s).then((function(t){return l.textContent=t.likes.length})),n.classList.add("card__like-button_active"))})),r.addEventListener("click",(function(){O(w),z.addEventListener("submit",(function(){var n;n=s,fetch("https://nomoreparties.co/v1/".concat(t,"/cards/").concat(n),{method:"DELETE",headers:{authorization:"".concat(e)}}).then((function(t){return o(t)})).catch((function(t){return console.log(t)})),c.remove(),J(w)}))})),u.addEventListener("click",(function(){O(y),S.src=i,S.alt=a,q.textContent=a}))}(d,_,l,f,c,u,s,p),l}L.addEventListener("click",(function(){return J(y)})),f.addEventListener("click",(function(){J(d),N(d,D)})),a.addEventListener("click",(function(){J(r),N(r,D)})),k.addEventListener("click",(function(){J(b),N(b,D)})),T.addEventListener("click",(function(){return J(w)}));var F=fetch("https://nomoreparties.co/v1/".concat(t,"/users/me"),{headers:{authorization:"".concat(e)}}).then((function(t){return o(t)})).catch((function(t){return console.log(t)})).then((function(t){l.textContent=t.name,p.textContent=t.about,x.src=t.avatar})),G=fetch("https://nomoreparties.co/v1/".concat(t,"/cards"),{headers:{authorization:"".concat(e)}}).then((function(t){return o(t)})).catch((function(t){return console.log(t)})).then((function(t){t.forEach((function(t){return I(U(t))}))}));function I(t){A.prepend(t)}i.addEventListener("submit",(function(n){n.preventDefault(),l.textContent=c.value,p.textContent=u.value,P.owner.name=c.value,P.owner.about=u.value;var a,i=this.querySelector(".popup__submit");i.textContent="Сохранение...",(a=P.owner,fetch("https://nomoreparties.co/v1/".concat(t,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(e),"Content-Type":"application/json"},body:JSON.stringify({name:a.name,about:a.about,avatar:"".concat(a.avatar)})}).then((function(t){return o(t)})).catch((function(t){return console.log(t)}))).then((function(){return J(r)})).finally((function(){return i.textContent="Сохранить"}))})),v.addEventListener("submit",(function(n){n.preventDefault(),P.name=m.value,P.link=h.value;var r,c,u=this.querySelector(".popup__submit");u.textContent="Создание...",(r=P.name,c=P.link,fetch("https://nomoreparties.co/v1/".concat(t,"/cards"),{method:"POST",headers:{authorization:"".concat(e),"Content-Type":"application/json"},body:JSON.stringify({name:r,link:"".concat(c)})}).then((function(t){return o(t)})).catch((function(t){return console.log(t)}))).then((function(t){I(U(t)),J(d)})).finally((function(){return u.textContent="Создать"})),v.reset()})),g.addEventListener("submit",(function(n){n.preventDefault(),P.owner.avatar="".concat(C.value);var r,c=this.querySelector(".popup__submit");c.textContent="Создание...",(r=P.owner,fetch("https://nomoreparties.co/v1/".concat(t,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(e),"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(r.avatar)})}).then((function(t){return o(t)})).catch((function(t){return console.log(t)}))).then((function(){return J(b)})).finally((function(){return c.textContent="Создать"})),x.src=C.value})),_.addEventListener("click",(function(){O(d),N(d,D)})),s.addEventListener("click",(function(){O(r),c.value=l.textContent,u.value=p.textContent,N(r,D)})),E.addEventListener("click",(function(){O(b),C.value=x.src,N(b,D)})),function(t){var e=t.formSelector;document.querySelectorAll(e).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=e.inputSelector,o=e.submitButtonSelector,r=t.querySelectorAll(n),c=t.querySelector(o),u=Array.from(r);j(u,c,e),r.forEach((function(n){n.addEventListener("input",(function(){!function(t,e,n){e.validity.valid?function(t,e,n){var o=n.errorClass,r=n.inputErrorClass;t.querySelector(".".concat(e.id,"-error")).classList.remove(o),e.classList.remove(r)}(t,e,n):function(t,e,n,o){var r=o.errorClass,c=o.inputErrorClass,u=t.querySelector(".".concat(e.id,"-error"));u.classList.add(r),u.textContent=n,e.classList.add(c)}(t,e,e.validationMessage,n)}(t,n,e),j(u,c,e)}))}))}(e,t)}))}(D),Promise.all([F,G])})();